<html>
	<body>
		<!-- Learn about this code on MDN: https://developer.mozilla.org/en-US/docs/Web/API/Screen_Capture_API/Using_Screen_Capture -->

		<p>
		Aliquet nec magna ridiculus, lobortis ultricies nibh posuere. Porttitor porttitor est sollicitudin lacus nam urna per condimentum. Vestibulum nullam, primis venenatis metus consectetur aliquam habitasse! Phasellus, vestibulum egestas adipiscing libero vivamus et etiam dignissim fusce! Felis ligula aliquet ultricies interdum molestie sed eros ullamcorper sapien inceptos felis tristique! Mattis, donec fringilla accumsan malesuada malesuada. Dolor nostra pretium inceptos, integer parturient fusce. Quis nascetur cras himenaeos placerat nisi ridiculus metus volutpat cursus! Consectetur vestibulum fringilla, sit auctor. A vel, lectus fermentum augue montes morbi potenti.
		</p>
		<p>
		Purus eleifend consequat facilisi proin nulla etiam quisque iaculis sociis adipiscing varius. Nostra eget faucibus massa iaculis sed nostra nulla. Leo, pretium neque non scelerisque sit luctus quam natoque. Dolor diam semper nunc faucibus. Ligula ut nullam accumsan, platea convallis nullam scelerisque. A lacus, dolor massa fames. Porttitor libero nibh praesent felis phasellus. Etiam sit mollis curae; ligula. Est per eros consequat nostra pharetra. Semper felis.
		</p>
		<p>
		Ac iaculis faucibus ullamcorper tristique primis ipsum ultrices tempus felis a. Ad pellentesque natoque molestie phasellus praesent odio auctor commodo lacinia. Sociis nam consequat potenti pretium dui praesent habitasse vel molestie facilisis iaculis! Senectus per montes rhoncus aliquet semper habitant morbi urna morbi tristique. Varius class libero cursus ullamcorper quam ornare cubilia. Vehicula, eu scelerisque.
		</p>
		<p>
		Orci, per cum ultrices pulvinar. Ultrices arcu nisl proin curabitur tincidunt! Erat posuere in class natoque fermentum rutrum porta facilisis malesuada ante. Nec ipsum conubia porta odio. Magnis faucibus ipsum euismod suscipit cubilia a. At tempor velit erat et proin cum curabitur accumsan mus montes vulputate. Imperdiet convallis facilisi semper! Etiam interdum posuere viverra quis et venenatis nascetur! Curabitur a hac, sociis nullam lobortis. Venenatis adipiscing pellentesque sapien pulvinar quis faucibus lacus molestie. Felis eros cum nascetur pulvinar volutpat viverra quisque. Parturient aenean pulvinar, convallis adipiscing quam fusce. Natoque fermentum cursus adipiscing sociosqu scelerisque id aenean mattis litora nam.
		</p>
		<p>
		Tincidunt urna volutpat porttitor sollicitudin pulvinar pulvinar per facilisis facilisis feugiat! Ullamcorper metus a dictum morbi pellentesque quisque at lobortis erat feugiat quisque ante? Vitae aptent hendrerit aenean proin enim congue tincidunt euismod scelerisque class nam. Magnis porttitor sollicitudin praesent porta blandit euismod. Tempor tempor curae; bibendum. Iaculis conubia pretium mattis velit adipiscing facilisi varius per. Convallis nunc purus congue curae;.
		</p>

		<p><button id="start">Submit feedback</button></p>

		<!-- The Modal -->
		<div id="myModal" class="modal">

			<!-- Modal content -->
			<div class="modal-content">
				<span class="close" id="close-modal">&times;</span>
				<p>Tell us what we can help you with</p>
				
				<p>
					<label>
						Email:
						<input type="email" width="100%" placeholder="email@example.com">
					</label>
				</p>
				<p>
					<label>
						Describe your problem:
						<textarea width="100%"></textarea>
					</label>
				</p>

				<p>Screenshot:</p>
				<img id="screenshot-img">
			</div>

		</div>

	</body>

<style>
#video {
	z-index: -1;
	width: 98%;
	max-width: 860px;
	position: absolute;
	height: 98%;
	max-height: 660px;
	left: 0;
	top: 0;
}

#video-cover {
	left: 0;
	top: 0;
	position: absolute;
	z-index: 1;
	width: 98%;
	max-width: 860px;
	height: 98%;
	max-height: 660px;
	//border: 1px solid #000;
	//background: blue;
}
/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 10; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
	height: 400px;
	width: 200px;
}

/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
	z-index: 10;
}

.close:hover {
	cursor: pointer;
}

#screenshot-img {
	max-width: 100%;
	max-height: 100%;
	border: 1px solid #000;
}
</style>

	<script>

function sleep(ms) {
	return new Promise(resolve => setTimeout(resolve, ms));
}

async function screenshot(options, callback) {
	var videoElem = document.createElement('video');
	videoElem.autoplay = true;
	var videoCoverElem = document.createElement('div');
	videoCoverElem.id = 'video-cover';
	videoElem.id = 'video';
	document.body.appendChild(videoCoverElem);
	document.body.appendChild(videoElem);
	var pageWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
	var pageHeight = window.innerHeight|| document.documentElement.clientHeight || document.body.clientHeight;
	var height = options.height || pageHeight;
	var width = options.width || pageWidth;
	videoElem.addEventListener('playing', async function(e) {
		if (videoElem.readyState === 4) {
			/* get the base64 url for our canvas image */
			var url = makeScreenshotFromCanvas(videoElem, height, width);

			/* stop screen recording */
			let tracks = videoElem.srcObject.getTracks();
			tracks.forEach(track => track.stop());
			videoElem.srcObject = null;
			document.body.removeChild(videoElem);
			document.body.removeChild(videoCoverElem);

			/* call the callback */
			callback(url);
		}
	});
	/* screen capture options */
	var displayMediaOptions = {
			video: {
				cursor: "never"
			},
			audio: false
	};
	/* start the screen capture */
	navigator.mediaDevices.getDisplayMedia(displayMediaOptions)
	.then(function(stream) {
		videoElem.srcObject = stream;
	}).catch(function(err) {
		console.log(err);
	});
}

function makeScreenshotFromCanvas(videoElem, height, width) {
		var canvas = document.createElement('canvas');
		var ctx = canvas.getContext('2d');
		canvas.width = width;
		canvas.height = height;
		ctx.drawImage(videoElem, 0, 0, canvas.width, canvas.height);
		return canvas.toDataURL('image/jpeg');
}

function feedbackPopup(url) {
	var img = document.getElementById("screenshot-img");
	img.src = url;
	img.alt = url;
	var modal = document.getElementById("myModal");
	modal.style.display = "block";
}

document.addEventListener('DOMContentLoaded', function() {
	var modal = document.getElementById("myModal");
	var img = document.getElementById("screenshot-img");

	document.getElementById('close-modal').addEventListener("click", function(e) {
		modal.style.display = "none";
	});
		
	// When the user clicks anywhere outside of the modal, close it
	//window.onclick = function(event) {
	//	if (event.target == modal) {
	//		modal.style.display = "none";
	//	}
	//}

	const startElem = document.getElementById("start");

	// Set event listeners for the start and stop buttons
	startElem.addEventListener("click", function(evt) {
		var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
		var height = window.innerHeight|| document.documentElement.clientHeight || document.body.clientHeight;
		var options = {
			width,
			height
		};
		screenshot(options, function(url) {
			feedbackPopup(url);
		});
	}, false);
});


	</script>
