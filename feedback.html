<html>
	<body>
		<!-- Learn about this code on MDN: https://developer.mozilla.org/en-US/docs/Web/API/Screen_Capture_API/Using_Screen_Capture -->

		<p>This example shows you the contents of the selected part of your display.
		Click the Start Capture button to begin.</p>

		<p><button id="start">Start Capture</button>&nbsp;<button id="stop">Stop Capture</button></p>
		<p><button id="save">Save Screenshot</button></p>

		<video id="video" autoplay></video>

	</body>

<style>
#video {
	  border: 1px solid #999;
			  width: 98%;
					  max-width: 860px;
}

				.error {
					  color: red;
				}

				.warn {
					  color: orange;
				}

				.info {
					  color: darkgreen;
				}
</style>

	<script>

function screenshot(options, callback) {
	var videoElem = document.createElement('video');
	document.appendChild(videoElem);
	var height = options.height || document.body.height;
	var width = options.width || document.body.width;
	var displayMediaOptions = {
			video: {
				cursor: "never"
			},
			audio: false
	};

	function startCapture() {
		navigator.mediaDevices.getDisplayMedia(displayMediaOptions)
		.then(function(stream) {
			videoElem.srcObject = stream;
			setTimeout(function() {
				saveScreenshot();
				stopCapture();
			}, 500);
		}).catch(function(err) {
			console.log(err);
		});
	}

	function createScreenshot(videoElem, height, width) {
			var canvas = document.createElement('canvas');
			var ctx = canvas.getContext('2d');
			canvas.width = width;
			canvas.height = height;
			ctx.drawImage(videoElem, 0, 0, canvas.width, canvas.height);

			var url = canvas.toDataURL('image/jpeg');
			var filename = 'screenshot-' + canvas.width + 'x' + canvas.height + '-' + videoElem.currentTime + '.jpg';

			// Wrap <img> in link to download image because 
			// the context menu Save Image as... is blocked for security reasons
			var a = document.createElement('a');
			a.download = filename;
			a.href = url;
			return url;

			var img = document.createElement('img');
			img.src = url;
			img.alt = filename;
			img.title = 'Click to save ' + filename;
			return url;
			//document.body.innerHTML = "";
			//document.body.appendChild(img);
			//window.open().document.body.appendChild(a).appendChild(img);
	}
}

const videoElem = document.getElementById("video");
const logElem = document.getElementById("log");
const startElem = document.getElementById("start");
const stopElem = document.getElementById("stop");
const saveElem = document.getElementById("save");

// Set event listeners for the start and stop buttons
startElem.addEventListener("click", function(evt) {
	  startCapture();
}, false);

saveElem.addEventListener("click", function(evt) {
	  startCapture();
}, false);
stopElem.addEventListener("click", function(evt) {
	  stopCapture();
}, false);

saveElem.addEventListener("click", function(evt) {
	saveScreenshot();
}, false);

function stopCapture(evt) {
	  let tracks = videoElem.srcObject.getTracks();
	  tracks.forEach(track => track.stop());
	  videoElem.srcObject = null;
}


	</script>
